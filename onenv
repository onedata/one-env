#!/usr/bin/env bash

SCRIPT_DIR=$( cd ${0%/*} && pwd -P )

usage_and_exit() {
    echo "usage: ${0} <command> - one of:"
    echo "      up     - sets up a onedata deployment on kubernetes cluster"
    echo "      status - displays the status of current onedata deployment"
    echo "      wait   - waits for current deployment to be ready"
    echo "      logs   - displays logs of chosen pod"
    echo "      exec   - execs to chosen pod with an interactive shell"
    echo "      attach - attaches directly to erlang VM in chosen pod"
    echo "      gui    - opens the GUI hosted on given pod in default browser"
    echo "      export - gathers all logs and data from current deployment and"
    echo "               places them in desired location"
    echo "      clean  - removes current onedata deployment and cleans up"
    echo ""
    echo "run '${0} <command> -h' to get more detailed help"
    exit 1
}

if [[ -z ${1} ]]; then
    usage_and_exit
fi

case "${1}" in
    up)
        SCRIPT="onenv_up.py"
        ;;

    status)
        SCRIPT="onenv_status.py"
        ;;

    wait)
        SCRIPT="onenv_wait.py"
        ;;

    logs)
        SCRIPT="onenv_logs.py"
        ;;

    exec)
        SCRIPT="onenv_exec.py"
        ;;

    attach)
        SCRIPT="onenv_attach.py"
        ;;

    gui)
        SCRIPT="onenv_gui.py"
        ;;

    export)
        SCRIPT="onenv_export.py"
        ;;

    clean)
        SCRIPT="onenv_clean.py"
        ;;

    update)
        SCRIPT="onenv_update.py"
        ;;

    watch)
        SCRIPT="onenv_watch.py"
        ;;

    patch)
        SCRIPT="onenv_patch.py"
        ;;

    *)
        usage_and_exit
        ;;
esac

shift
/usr/bin/env python3 ${SCRIPT_DIR}/scripts/${SCRIPT} "$@"
