apiVersion: v1
kind: Pod
metadata:
  annotations:
    version: 0.2.10
  creationTimestamp: 2018-07-23T11:01:53Z
  generateName: dev-oneclient-krakow-86bf8658c4-
  labels:
    app: dev-oneclient-krakow
    chart: oneclient
    heritage: Tiller
    pod-template-hash: "4269421470"
    release: dev
  name: dev-oneclient-krakow-86bf8658c4-bd98p
  namespace: default
  ownerReferences:
  - apiVersion: apps/v1
    blockOwnerDeletion: true
    controller: true
    kind: ReplicaSet
    name: dev-oneclient-krakow-86bf8658c4
    uid: ce7f6401-8e67-11e8-8cca-54bf6418bbff
  resourceVersion: "9565"
  selfLink: /api/v1/namespaces/default/pods/dev-oneclient-krakow-86bf8658c4-bd98p
  uid: ce846d76-8e67-11e8-8cca-54bf6418bbff
spec:
  containers:
  - command:
    - sh
    - -c
    - |
      echo "source /oneclient-mount.sh" >> ~/.bashrc ; idp=onepanel; ONECLIENT_ACCESS_TOKEN=$(curl --silent -k -u joe:password http://dev-token-dispenser/api/v1.0/token/$idp); mount_dir="/mnt/oneclient/joe"; mkdir -p "$mount_dir"; echo "Mounting oneclient in $mount_dir for user=joe, from idp=$idp, using TOKEN=$ONECLIENT_ACCESS_TOKEN."; oneclient -t $ONECLIENT_ACCESS_TOKEN "$mount_dir"; while ! mount | grep -q "$mount_dir" ; do i=1; max_i=30; while ! mount| grep -q "$mount_dir" && [ $i -le $max_i ] ; do echo "Wainting ${i}/${max_i} time for mount $mount_dir. Sleeping for 2 seconds." ; i=$((i+1)) ; sleep 2 ; done ; if mount | grep -q /mnt/oneclient/meg ; then break ; else echo "Failed to mount $mount_dir retrying to run oneclient for dir=$mount_dir" ; fi  ; done ; echo "Success, mounted $mount_dir." ; echo "All clients have been mounted." ; touch /all_oneclients_mounted ; sleep infinity ;
    env:
    - name: ONECLIENT_INSECURE
      value: "true"
    - name: ONECLIENT_ACCESS_TOKEN
      value: supplied_at_runtime
    - name: ONECLIENT_PROVIDER_HOST
      value: dev-oneprovider-krakow
    image: onedata/oneclient:18.02.0-rc7
    imagePullPolicy: IfNotPresent
    name: oneclient
    readinessProbe:
      exec:
        command:
        - cat
        - /all_oneclients_mounted
      failureThreshold: 3
      periodSeconds: 10
      successThreshold: 1
      timeoutSeconds: 1
    resources: {}
    securityContext:
      privileged: true
    terminationMessagePath: /dev/termination-log
    terminationMessagePolicy: File
    volumeMounts:
    - mountPath: /oneclient-mount.sh
      name: oneclient-mount
      readOnly: true
      subPath: oneclient-mount.sh
    - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
      name: default-token-jzhkv
      readOnly: true
  dnsPolicy: ClusterFirst
  hostname: oneclient
  initContainers:
  - args:
    - job
    - dev-onezone-ready-check
    image: onedata/k8s-wait-for:v1.1
    imagePullPolicy: IfNotPresent
    name: wait-for-onezone
    resources: {}
    terminationMessagePath: /dev/termination-log
    terminationMessagePolicy: File
    volumeMounts:
    - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
      name: default-token-jzhkv
      readOnly: true
  - args:
    - pod
    - |
      -lapp=dev-token-dispenser
    image: onedata/k8s-wait-for:v1.1
    imagePullPolicy: IfNotPresent
    name: wait-for-token-dispenser
    resources: {}
    terminationMessagePath: /dev/termination-log
    terminationMessagePolicy: File
    volumeMounts:
    - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
      name: default-token-jzhkv
      readOnly: true
  - args:
    - job
    - dev-oneprovider-krakow-ready-check
    image: onedata/k8s-wait-for:v1.1
    imagePullPolicy: IfNotPresent
    name: wait-for-oneprovider
    resources: {}
    terminationMessagePath: /dev/termination-log
    terminationMessagePolicy: File
    volumeMounts:
    - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
      name: default-token-jzhkv
      readOnly: true
  nodeName: michal-g3-3579
  priority: 0
  restartPolicy: Always
  schedulerName: default-scheduler
  securityContext: {}
  serviceAccount: default
  serviceAccountName: default
  subdomain: dev-oneclient-krakow
  terminationGracePeriodSeconds: 30
  tolerations:
  - effect: NoExecute
    key: node.kubernetes.io/not-ready
    operator: Exists
    tolerationSeconds: 300
  - effect: NoExecute
    key: node.kubernetes.io/unreachable
    operator: Exists
    tolerationSeconds: 300
  volumes:
  - configMap:
      defaultMode: 420
      items:
      - key: oneclient-mount.sh
        path: oneclient-mount.sh
      name: dev-oneclient-krakow-config
    name: oneclient-mount
  - name: default-token-jzhkv
    secret:
      defaultMode: 420
      secretName: default-token-jzhkv
status:
  conditions:
  - lastProbeTime: null
    lastTransitionTime: 2018-07-23T11:02:59Z
    status: "True"
    type: Initialized
  - lastProbeTime: null
    lastTransitionTime: 2018-07-23T11:01:53Z
    message: 'containers with unready status: [oneclient]'
    reason: ContainersNotReady
    status: "False"
    type: Ready
  - lastProbeTime: null
    lastTransitionTime: null
    message: 'containers with unready status: [oneclient]'
    reason: ContainersNotReady
    status: "False"
    type: ContainersReady
  - lastProbeTime: null
    lastTransitionTime: 2018-07-23T11:01:53Z
    status: "True"
    type: PodScheduled
  containerStatuses:
  - containerID: docker://888e68935322d67ac1211b69c36457997ce80ffbf6f854a3d1f63fc15592575b
    image: onedata/oneclient:18.02.0-rc7
    imageID: docker-pullable://onedata/oneclient@sha256:3d601978a140da281718116f7461ccf99b5b1683e265e4b48591d62be74290e6
    lastState: {}
    name: oneclient
    ready: false
    restartCount: 0
    state:
      running:
        startedAt: 2018-07-23T11:03:22Z
  hostIP: 172.19.160.159
  initContainerStatuses:
  - containerID: docker://dda4bf2392f49e7ac71b5714870c96d51c7838df10d549192875f8fbf351a944
    image: onedata/k8s-wait-for:v1.1
    imageID: docker-pullable://onedata/k8s-wait-for@sha256:cff1f8605e39e28cff7a0b85518c14a3f02a3ec785ca0fdb73952abf41bac73b
    lastState: {}
    name: wait-for-onezone
    ready: true
    restartCount: 0
    state:
      terminated:
        containerID: docker://dda4bf2392f49e7ac71b5714870c96d51c7838df10d549192875f8fbf351a944
        exitCode: 0
        finishedAt: 2018-07-23T11:02:41Z
        reason: Completed
        startedAt: 2018-07-23T11:01:56Z
  - containerID: docker://b98dfe161138182b4505ad7e4047b1aed9480953f7b87a77e861083ce3d9a1af
    image: onedata/k8s-wait-for:v1.1
    imageID: docker-pullable://onedata/k8s-wait-for@sha256:cff1f8605e39e28cff7a0b85518c14a3f02a3ec785ca0fdb73952abf41bac73b
    lastState: {}
    name: wait-for-token-dispenser
    ready: true
    restartCount: 0
    state:
      terminated:
        containerID: docker://b98dfe161138182b4505ad7e4047b1aed9480953f7b87a77e861083ce3d9a1af
        exitCode: 0
        finishedAt: 2018-07-23T11:02:44Z
        reason: Completed
        startedAt: 2018-07-23T11:02:43Z
  - containerID: docker://2be6d55f8976d3e4b7455397af2a05e500539efc3e73a7e3eb9e4f43da59d378
    image: onedata/k8s-wait-for:v1.1
    imageID: docker-pullable://onedata/k8s-wait-for@sha256:cff1f8605e39e28cff7a0b85518c14a3f02a3ec785ca0fdb73952abf41bac73b
    lastState: {}
    name: wait-for-oneprovider
    ready: true
    restartCount: 0
    state:
      terminated:
        containerID: docker://2be6d55f8976d3e4b7455397af2a05e500539efc3e73a7e3eb9e4f43da59d378
        exitCode: 0
        finishedAt: 2018-07-23T11:02:58Z
        reason: Completed
        startedAt: 2018-07-23T11:02:45Z
  phase: Running
  podIP: 10.32.0.7
  qosClass: BestEffort
  startTime: 2018-07-23T11:01:53Z
